<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AFGE Local 2206 - Grievance Mastery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;600;800&family=Great+Vibes&family=Courier+Prime&display=swap');
       
        body {
            font-family: 'Lexend', sans-serif;
            background-color: #020617;
            color: #f8fafc;
            background: radial-gradient(circle at top right, #0f172a, #020617);
            background-attachment: fixed;
        }

        .glass-panel {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.8);
        }

        .active-nav-item {
            border-left: 4px solid #f59e0b;
            background: linear-gradient(to right, rgba(245, 158, 11, 0.2), transparent) !important;
            color: #f59e0b !important;
            font-weight: 800;
        }

        .visited-nav-item {
            color: #94a3b8 !important;
            border-left: 4px solid #3b82f6;
            background: linear-gradient(to right, rgba(59, 130, 246, 0.05), transparent);
        }

        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 15px rgba(245, 158, 11, 0.4); }
            50% { box-shadow: 0 0 35px rgba(245, 158, 11, 0.8); transform: scale(1.05); }
        }
        .play-btn-glow { animation: pulse-glow 3s infinite; }

        @keyframes slide-up {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-up { animation: slide-up 0.4s ease-out forwards; }

        .chat-bubble-user {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.1));
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 1.5rem 1.5rem 0 1.5rem;
        }

        .chat-bubble-ai {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(217, 119, 6, 0.05));
            border: 1px solid rgba(245, 158, 11, 0.2);
            border-radius: 1.5rem 1.5rem 1.5rem 0;
        }

        #master-play-btn { display: none; }
       
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .prose-content b, .prose-content strong { color: #f59e0b; font-weight: 800; }
        .prose-content p { margin-bottom: 1.25rem; line-height: 1.7; font-size: 1rem; color: #cbd5e1; }
        .prose-content ul { list-style-type: disc; padding-left: 1.5rem; margin-bottom: 1.25rem; }
        .prose-content li { margin-bottom: 0.5rem; color: #94a3b8; }
        .prose-content h3 { color: #f59e0b; font-weight: 800; margin-top: 1.5rem; margin-bottom: 0.75rem; text-transform: uppercase; font-size: 0.85rem; border-bottom: 1px solid rgba(245, 158, 11, 0.2); padding-bottom: 4px; }
       
        .doc-snippet {
            font-family: 'Courier Prime', monospace;
            background: #ffffff;
            color: #1e293b;
            padding: 1.5rem;
            border-radius: 0.5rem;
            border-left: 6px solid #f59e0b;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
            font-size: 0.85rem;
            line-height: 1.5;
            margin: 1.5rem 0;
        }

        .history-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.05);
            transition: all 0.2s ease;
            cursor: pointer;
            padding: 12px;
            border-radius: 12px;
        }
        .history-card:hover {
            background: rgba(245, 158, 11, 0.1);
            border-color: rgba(245, 158, 11, 0.4);
            transform: translateX(4px);
        }

        #report-paper {
            background: white;
            color: #1e293b;
            padding: 40px;
            box-shadow: 0 0 60px rgba(0,0,0,0.6);
            border: 1px solid #e2e8f0;
        }

        #certificate-paper {
            background: white;
            color: #1e293b;
            padding: 60px;
            border: 15px double #f59e0b;
            position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 86c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zm66-3c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zm-40-39c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zm0-24c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM3 40c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zm39 25c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zm54-14c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM46 25c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zm15-15c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zm0 75c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zm10-56c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zm-56 6c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zm41 11c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zm54 14c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zm-8-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zm-86-14c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zm19 0c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zm-11 28c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zm60-28c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zm14 7c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23f59e0b' fill-opacity='0.03' fill-rule='evenodd'/%3E%3C/svg%3E");
        }

        .illustration-bg {
            background: linear-gradient(45deg, #0f172a, #1e293b);
            border-radius: 1.5rem;
            box-shadow: inset 0 0 40px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            min-height: 250px;
        }

        .card-glow:hover {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.2);
        }

        #cert-display-name {
            font-family: 'Great Vibes', cursive;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col overflow-x-hidden text-slate-200">

    <!-- Header -->
    <header class="h-auto py-3 lg:h-16 flex flex-col lg:flex-row items-center justify-between px-4 lg:px-6 glass-panel border-b border-white/5 z-50 sticky top-0">
        <div class="flex items-center justify-between w-full lg:w-auto mb-3 lg:mb-0">
            <div class="flex items-center gap-3">
                <div class="bg-amber-500 p-2 rounded-lg shadow-lg">
                    <i class="fa-solid fa-building-columns text-slate-950 text-base"></i>
                </div>
                <div>
                    <h1 class="text-sm lg:text-lg font-extrabold tracking-tight uppercase text-white">AFGE Local 2206 <span class="text-amber-500">Academy</span></h1>
                    <div class="hidden sm:flex items-center gap-2">
                        <div class="h-1 w-16 lg:w-24 bg-slate-800 rounded-full overflow-hidden">
                            <div id="progress-bar" class="h-full bg-amber-500 transition-all duration-1000" style="width: 0%;"></div>
                        </div>
                        <span id="progress-text" class="text-[8px] uppercase font-bold text-slate-500 tracking-widest text-center">Course Initiation</span>
                    </div>
                </div>
            </div>
            <button onclick="window.toggleMobileSidebar(true)" class="lg:hidden p-2 text-slate-400 hover:text-white">
                <i class="fa-solid fa-bars-staggered text-xl"></i>
            </button>
        </div>
       
        <div class="flex items-center overflow-x-auto w-full lg:w-auto no-scrollbar">
            <nav class="flex gap-1 bg-slate-900/50 p-1 rounded-xl border border-white/5 mx-auto lg:mx-0 min-w-max">
                <button onclick="window.switchMode('academy')" id="mode-academy" class="px-3 lg:px-4 py-1.5 rounded-lg text-[10px] lg:text-xs font-bold transition-all bg-amber-500 text-slate-950 shadow-lg">TRAINING</button>
                <button onclick="window.switchMode('field-kit')" id="mode-field-kit" class="px-3 lg:px-4 py-1.5 rounded-lg text-[10px] lg:text-xs font-bold transition-all text-slate-400 hover:text-white">FIELD KIT</button>
                <button onclick="window.switchMode('ai-guide')" id="mode-ai-guide" class="px-3 lg:px-4 py-1.5 rounded-lg text-[10px] lg:text-xs font-bold transition-all text-slate-400 hover:text-white">AI GUIDE</button>
                <button onclick="window.switchMode('resources')" id="mode-resources" class="px-3 lg:px-4 py-1.5 rounded-lg text-[10px] lg:text-xs font-bold transition-all text-slate-400 hover:text-white">RESOURCES</button>
                <button onclick="window.switchMode('setup')" id="mode-setup" class="px-3 lg:px-4 py-1.5 rounded-lg text-[10px] lg:text-xs font-bold transition-all text-slate-400 hover:text-white">
                    <i class="fa-solid fa-key mr-1"></i>SETUP
                </button>
            </nav>
        </div>
    </header>

    <div class="flex flex-1 relative overflow-hidden">
        <!-- Sidebar -->
        <div id="mobile-sidebar-overlay" onclick="window.toggleMobileSidebar(false)" class="fixed inset-0 bg-black/60 z-[60] lg:hidden opacity-0 pointer-events-none"></div>
        <aside id="mobile-sidebar" class="fixed inset-y-0 left-0 w-64 glass-panel z-[70] lg:relative lg:w-72 border-r border-white/5 overflow-y-auto custom-scroll flex flex-col -translate-x-full lg:translate-x-0">
            <div class="p-6 flex-1 text-slate-300">
                <div class="flex justify-between items-center mb-6 lg:hidden">
                    <h2 class="text-[10px] font-black text-amber-500 uppercase tracking-widest">Syllabus</h2>
                    <button onclick="window.toggleMobileSidebar(false)" class="text-slate-500"><i class="fa-solid fa-xmark"></i></button>
                </div>
               
                <div class="hidden lg:block text-center mb-8 border-b border-white/5 pb-4">
                    <h2 class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-1">Course Curriculum</h2>
                    <p class="text-[11px] font-bold text-amber-500 uppercase tracking-tighter italic font-serif">Grievance Mastery: From Incident to Arbitration</p>
                </div>

                <div class="space-y-8">
                    <section>
                        <h3 class="text-[10px] font-bold text-blue-400 uppercase mb-4 flex items-center gap-2">
                            <i class="fa-solid fa-shield-halved"></i> Week 1: Foundations
                        </h3>
                        <div id="nav-week-1" class="space-y-1"></div>
                    </section>
                    <section>
                        <h3 class="text-[10px] font-bold text-amber-400 uppercase mb-4 flex items-center gap-2">
                            <i class="fa-solid fa-gavel"></i> Week 2: Advanced
                        </h3>
                        <div id="nav-week-2" class="space-y-1"></div>
                    </section>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main id="main-scroll-container" class="flex-1 overflow-y-auto overflow-x-hidden bg-transparent p-3 lg:p-6 relative custom-scroll pb-24 text-slate-200">
           
            <!-- Academy View -->
            <div id="academy-view" class="flex flex-col gap-4 lg:gap-6 animate-slide-up max-w-7xl mx-auto w-full">
                <div id="video-canvas" class="relative rounded-2xl lg:rounded-[2.5rem] overflow-hidden glass-panel border border-white/10 shadow-2xl flex flex-col group min-h-[450px] lg:min-h-[650px]">
                    <div id="visual-frame" class="flex-1 relative flex items-center justify-center bg-slate-950 overflow-hidden p-4">
                        <div id="image-container" class="w-full h-full flex items-center justify-center illustration-bg rounded-2xl overflow-hidden border border-white/5">
                        </div>
                    </div>

                    <div class="min-h-[16rem] lg:min-h-[28rem] h-auto bg-slate-900/90 border-t border-white/5 p-6 lg:p-12 flex flex-col items-center overflow-y-auto custom-scroll text-white">
                        <div id="script-header" class="text-[8px] lg:text-[10px] font-bold text-amber-500 uppercase mb-4 tracking-[0.3em] border-b border-amber-500/20 pb-1 w-full text-center">Instructor address: Full Academic Training Material</div>
                        <div id="live-transcript-container" class="prose-content max-w-5xl">
                             <div id="live-transcript" class="text-sm lg:text-base font-medium text-slate-300 text-center leading-relaxed whitespace-pre-line">
                                Welcome, Representative. Select a syllabus day and press Play to begin your professional training lecture.
                             </div>
                        </div>
                        <div class="mt-8 flex flex-wrap justify-center gap-3">
                            <button id="summary-btn" onclick="window.generateSummary()" class="text-[9px] lg:text-[10px] font-bold bg-blue-500/10 border border-blue-500/20 px-6 lg:px-8 py-2.5 rounded-full text-blue-400 hover:bg-blue-500/20 transition-all hidden uppercase tracking-widest">
                                <i class="fa-solid fa-list-check mr-2"></i>  Get Tactical Cheat Sheet
                            </button>
                            <button id="scenario-btn" onclick="window.generatePracticeScenario()" class="text-[9px] lg:text-[10px] font-bold bg-amber-500/10 border border-amber-500/20 px-6 lg:px-8 py-2.5 rounded-full text-amber-500 hover:bg-amber-500/20 transition-all hidden uppercase tracking-widest">
                                <i class="fa-solid fa-brain mr-2"></i>  Generate AI Case Challenge
                            </button>
                            <button id="claim-cert-btn" onclick="window.switchMode('certificate')" class="text-[9px] lg:text-[10px] font-bold bg-green-500/10 border border-green-500/20 px-6 lg:px-8 py-2.5 rounded-full text-green-500 hover:bg-green-500/20 transition-all hidden uppercase tracking-widest animate-pulse"> Claim Your Certificate</button>
                        </div>
                    </div>

                    <div class="absolute bottom-[420px] lg:bottom-[480px] right-4 lg:right-10 z-40">
                        <button id="master-play-btn" onclick="window.playCurrentLesson()" class="w-16 h-16 lg:w-24 lg:h-24 rounded-full bg-amber-500 text-slate-950 text-2xl lg:text-4xl flex items-center justify-center shadow-2xl hover:scale-110 active:scale-95 transition-all play-btn-glow border-4 border-slate-900">
                            <i class="fa-solid fa-play ml-1"></i>
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 lg:gap-6">
                    <!-- MAIN ACTIVITY PANEL -->
                    <div id="activity-panel" class="glass-panel rounded-2xl lg:rounded-3xl p-5 lg:p-8 border-l-4 border-amber-500/50 flex flex-col card-glow min-h-[300px]">
                        <div id="activity-content-container">
                            <h4 class="text-[10px] font-black text-amber-400 uppercase tracking-widest mb-3 lg:mb-4 flex items-center gap-2">
                                <i class="fa-solid fa-pen-nib"></i> Independent Task
                            </h4>
                            <div id="hands-on-activity" class="text-xs lg:text-sm leading-relaxed space-y-4 flex-1 prose-content text-slate-300">
                                Selection pending...
                            </div>
                        </div>

                        <!-- AI CHALLENGE VIEW -->
                        <div id="ai-challenge-container" class="mt-2 hidden animate-slide-up">
                            <div class="flex items-center justify-between mb-3 border-b border-amber-500/20 pb-2">
                                <h5 class="text-[10px] font-black text-amber-500 uppercase tracking-[0.2em]"> Active Case Challenge</h5>
                                <div class="flex gap-4">
                                    <button onclick="window.generatePracticeScenario(true)" class="text-[8px] font-black uppercase text-amber-400 hover:text-white transition-all underline">Refresh Case</button>
                                    <button onclick="window.restoreActivityUI()" class="text-[8px] font-black uppercase text-slate-500 hover:text-white transition-all underline">Back to Task</button>
                                </div>
                            </div>
                            <div id="ai-challenge-box" class="p-4 bg-amber-500/5 border border-amber-500/10 rounded-xl text-[11px] lg:text-xs text-amber-100/90 leading-relaxed prose-content"></div>
                        </div>

                        <!-- FEEDBACK AREA -->
                        <div id="ai-feedback-container" class="mt-6 pt-4 border-t border-white/10 hidden animate-slide-up">
                            <div class="flex items-center gap-2 mb-3">
                                <div class="w-2 h-2 bg-amber-500 rounded-full animate-pulse"></div>
                                <h5 class="text-[10px] font-black text-amber-500 uppercase tracking-[0.2em]">Chief Steward's Critique</h5>
                            </div>
                            <div id="ai-feedback-box" class="p-5 bg-amber-500/5 border border-amber-500/20 rounded-xl text-xs text-amber-100 leading-relaxed italic prose-content"></div>
                            <button onclick="window.clearFeedback()" class="mt-3 text-[8px] font-black uppercase text-slate-500 hover:text-white transition-all underline tracking-widest">Dismiss Feedback</button>
                        </div>

                        <!-- INPUT AREA -->
                        <div id="peer-review-section" class="mt-6 pt-6 border-t border-white/10 hidden">
                            <textarea id="activity-input" class="w-full bg-slate-900 border border-white/10 rounded-xl p-4 text-[11px] lg:text-xs text-slate-300 focus:outline-none focus:border-amber-500 mb-3" placeholder="Draft your answer here for AI feedback..."></textarea>
                            <button onclick="window.getAIFeedback()" id="review-btn" class="w-full py-3 bg-slate-800 text-amber-500 font-bold rounded-xl text-[10px] uppercase tracking-[0.2em] hover:bg-slate-700 transition-all border border-amber-500/20 shadow-lg shadow-amber-500/5">
                                Get AI Chief Steward Feedback
                            </button>
                        </div>
                    </div>

                    <div class="flex flex-col gap-4 lg:gap-6">
                        <div class="glass-panel rounded-2xl lg:rounded-3xl p-5 lg:p-8 border-l-4 border-blue-500/50 card-glow flex-1">
                            <h4 class="text-[10px] font-black text-blue-400 uppercase tracking-widest mb-3 lg:mb-4 flex items-center gap-2">
                                <i class="fa-solid fa-box-archive"></i> Last Case Review
                            </h4>
                            <div id="challenge-log-box" class="text-xs lg:text-sm leading-relaxed text-slate-400 italic prose-content max-h-[300px] overflow-y-auto custom-scroll">
                                No recently generated cases.
                            </div>
                        </div>

                        <div class="glass-panel rounded-2xl lg:rounded-3xl p-5 lg:p-8 border-l-4 border-slate-500/50 card-glow">
                             <h4 class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3 lg:mb-4 flex items-center gap-2">
                                <i class="fa-solid fa-lightbulb"></i> Strategic Tip
                            </h4>
                            <div id="steward-instruction" class="text-xs lg:text-sm leading-relaxed space-y-4 prose-content text-slate-300">
                                Selection pending...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Field Kit View -->
            <div id="field-kit-view" class="hidden flex flex-col gap-6 animate-slide-up max-w-7xl mx-auto w-full">
                <div class="mb-4 lg:mb-8 text-center lg:text-left flex flex-col sm:flex-row justify-between items-end gap-4">
                    <div>
                        <h2 class="text-3xl lg:text-4xl font-black text-white">Representative's <span class="text-amber-500">Field Kit</span></h2>
                        <p class="text-slate-400 mt-2 text-sm">Strategic tools for incident analysis and grievance drafting.</p>
                    </div>
                    <button onclick="window.switchMode('academy')" class="px-6 py-2 bg-slate-800 text-white rounded-xl text-[10px] font-black uppercase border border-white/10 hover:border-amber-500/40 transition-all">
                        <i class="fa-solid fa-graduation-cap mr-2"></i> Return to Training
                    </button>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 pb-20 text-slate-200">
                    <div class="lg:col-span-2 glass-panel p-6 lg:p-8 rounded-2xl border border-white/10 space-y-6">
                        <div class="flex justify-between items-center">
                            <h3 class="text-xs font-black uppercase text-amber-500 tracking-widest">Incident Analysis Workspace</h3>
                            <button onclick="window.resetFieldKit()" class="text-[9px] font-black uppercase bg-slate-800 px-3 py-1.5 rounded-lg border border-white/10 hover:bg-red-500/20 transition-all">
                                <i class="fa-solid fa-rotate-left mr-1"></i> Reset Workspace
                            </button>
                        </div>
                        <textarea id="grievance-input" class="w-full h-48 bg-slate-900/50 border border-white/10 rounded-xl p-4 text-xs lg:text-sm focus:border-amber-500 outline-none text-white" placeholder="Describe the management action in full detail..."></textarea>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                            <button onclick="window.generateGrievanceHelp()" id="case-analyze-btn" class="py-3 bg-amber-500 text-slate-950 font-bold rounded-xl text-[10px] uppercase tracking-widest transition-all"> Analyze Case</button>
                            <button onclick="window.generateFullReport()" id="case-report-btn" class="py-3 bg-blue-600 text-white font-bold rounded-xl text-[10px] uppercase tracking-widest hover:bg-blue-500 transition-all shadow-lg">
                                Generate Strategic Case Report
                            </button>
                            <button onclick="window.generateRebuttals()" id="case-rebuttal-btn" class="sm:col-span-2 py-4 bg-slate-800 text-white border border-amber-500/30 font-black rounded-xl text-[10px] uppercase tracking-widest hover:bg-slate-700 transition-all">
                                Generate Tactical Rebuttals
                            </button>
                        </div>
                        <div id="grievance-output" class="hidden p-5 bg-slate-950/80 border border-white/10 rounded-xl text-xs text-slate-300 overflow-y-auto max-h-[500px] custom-scroll prose-content"></div>
                    </div>
                    <div class="space-y-6">
                        <div class="glass-panel p-6 rounded-2xl border border-white/10 flex flex-col h-full max-h-[800px]">
                            <h3 class="text-xs font-black uppercase text-blue-400 mb-4 tracking-widest border-b border-white/10 pb-2 flex items-center gap-2">
                                <i class="fa-solid fa-clock-rotate-left"></i> History (Last 20)
                            </h3>
                            <div id="history-list" class="flex-1 overflow-y-auto space-y-3 custom-scroll pr-2 text-xs"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Guide View -->
            <div id="ai-guide-view" class="hidden flex flex-col gap-6 animate-slide-up max-w-7xl mx-auto w-full">
                <div class="mb-4 lg:mb-8 text-center lg:text-left flex flex-col sm:flex-row justify-between items-end gap-4">
                    <div>
                        <h2 class="text-3xl lg:text-4xl font-black text-white">AI <span class="text-blue-500">Steward Suite</span></h2>
                        <p class="text-slate-400 mt-2 text-sm text-center lg:text-left">Strategic consultation and Roleplay Simulation.</p>
                    </div>
                    <button onclick="window.switchMode('academy')" class="px-6 py-2 bg-slate-800 text-white rounded-xl text-[10px] font-black uppercase border border-white/10 hover:border-amber-500/40 transition-all">
                        <i class="fa-solid fa-graduation-cap mr-2"></i> Return to Training
                    </button>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 h-[700px] text-slate-200">
                    <div class="glass-panel rounded-3xl border border-white/10 flex flex-col overflow-hidden">
                        <div class="p-4 border-b border-white/10 bg-slate-900/50 uppercase text-[10px] font-black tracking-widest text-blue-400">Options</div>
                        <div class="p-4 space-y-3">
                             <button onclick="window.setChatMode('consult')" id="mode-consult" class="w-full text-left p-3 rounded-xl bg-blue-500/20 text-blue-300 font-bold text-xs uppercase border border-blue-500/30">Consultation</button>
                             <button onclick="window.setChatMode('roleplay')" id="mode-roleplay" class="w-full text-left p-3 rounded-xl bg-slate-800 text-slate-400 font-bold text-xs uppercase border border-transparent">Roleplay Sim</button>
                        </div>
                        <div id="chat-history-list" class="flex-1 overflow-y-auto p-4 space-y-2 custom-scroll text-xs"></div>
                        <button onclick="window.clearChat()" class="p-4 text-[8px] font-black uppercase text-slate-500 hover:text-red-400 transition-all border-t border-white/5">Clear Session</button>
                    </div>
                    <div class="lg:col-span-3 flex flex-col glass-panel rounded-3xl border border-white/10 overflow-hidden relative shadow-2xl">
                        <div class="flex-1 p-6 overflow-y-auto custom-scroll space-y-6" id="chat-messages"></div>
                        <div class="p-4 bg-slate-900/80 border-t border-white/10 flex gap-3">
                            <input type="text" id="chat-input" onkeypress="if(event.key==='Enter') window.sendChatMessage()" class="flex-1 bg-slate-950 border border-white/10 rounded-2xl px-6 py-4 text-xs lg:text-sm text-white focus:outline-none focus:border-blue-500 shadow-inner" placeholder="Ask AI Steward a question...">
                            <button id="chat-send-btn" onclick="window.sendChatMessage()" class="w-14 h-14 bg-blue-600 rounded-2xl flex items-center justify-center text-white shadow-lg"><i class="fa-solid fa-paper-plane text-xl"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Setup View -->
            <div id="setup-view" class="hidden flex flex-col gap-6 animate-slide-up max-w-4xl mx-auto w-full p-4">
                <h2 class="text-3xl lg:text-4xl font-black text-white text-center">AI <span class="text-amber-500">Configuration</span></h2>
                <div class="glass-panel p-8 rounded-[2rem] border border-blue-500/20 flex flex-col gap-6 text-left">
                    <div class="space-y-6">
                        <div class="p-4 bg-blue-500/10 border border-blue-500/20 rounded-xl">
                            <h3 class="text-sm font-black text-blue-400 uppercase tracking-widest mb-2">Activation Mode</h3>
                            <p class="text-xs text-slate-400 leading-relaxed">
                                To enable AI features on GitHub, paste your Gemini API key below. This key is saved in your browser's Local Storage for persistence.
                            </p>
                        </div>

                        <div>
                            <h3 class="text-sm font-black text-blue-400 uppercase tracking-widest mb-4">Activation Guide</h3>
                            <ol class="space-y-4 text-xs lg:text-sm text-slate-300">
                                <li class="flex gap-4">
                                    <span class="w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center text-[10px] font-bold shrink-0">1</span>
                                    <div>Visit <strong><a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-blue-400 underline hover:text-blue-300">Google AI Studio</a></strong>.</div>
                                </li>
                                <li class="flex gap-4">
                                    <span class="w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center text-[10px] font-bold shrink-0">2</span>
                                    <div>Create/Copy your API key.</div>
                                </li>
                                <li class="flex gap-4">
                                    <span class="w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center text-[10px] font-bold shrink-0">3</span>
                                    <div>Paste it below and click Save.</div>
                                </li>
                            </ol>
                        </div>
                    </div>
                    <div class="pt-6 border-t border-white/5">
                        <input type="password" id="user-api-key" class="w-full bg-slate-900 border border-white/10 rounded-xl px-4 py-3 text-sm focus:border-amber-500 outline-none text-white" placeholder="Paste Gemini API Key here...">
                        <button onclick="window.saveUserKeyUI()" class="w-full py-4 bg-amber-500 text-slate-950 font-black rounded-xl uppercase mt-4 text-[10px] shadow-lg hover:scale-[1.02] transition-transform">Save Locally & Activate AI</button>
                    </div>
                </div>
            </div>

            <!-- Resources View -->
            <div id="resources-view" class="hidden flex flex-col animate-slide-up max-w-7xl mx-auto w-full px-4">
                <div class="mb-8 text-center lg:text-left">
                    <h2 class="text-3xl lg:text-4xl font-black text-white">Representative <span class="text-amber-500">Resource Hub</span></h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pb-20 text-slate-200">
                    <div class="glass-panel p-6 rounded-2xl border border-white/10 space-y-4 flex flex-col">
                        <div class="flex items-center gap-3"><div class="w-10 h-10 bg-amber-500/20 rounded-lg flex items-center justify-center text-amber-500"><i class="fa-solid fa-file-contract"></i></div><h3 class="uppercase text-xs">National Contract</h3></div>
                        <div class="space-y-2 flex flex-col">
                            <a href="https://www.afge.org/globalassets/documents/ssa/master-agreement/2024-ssa-afge-master-agreement.pdf" target="_blank" class="p-3 bg-slate-900/50 rounded-xl hover:bg-amber-500/10 transition-all text-blue-400 underline font-bold">2024 Master Agreement</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Report View -->
            <div id="report-display-view" class="hidden flex flex-col items-center animate-slide-up max-w-5xl mx-auto w-full p-4 pb-24 text-slate-900">
                <div id="report-controls" class="w-full mb-6 flex justify-between items-center glass-panel p-4 rounded-2xl border-white/10">
                    <button onclick="window.switchMode('field-kit')" class="text-xs font-bold text-slate-400 hover:text-white"><i class="fa-solid fa-arrow-left mr-2"></i> Back</button>
                    <button onclick="window.print()" class="px-6 py-2 bg-amber-500 text-slate-950 font-black rounded-xl text-[10px] uppercase">Print Strategy</button>
                </div>
                <div id="report-paper" class="w-full bg-white p-12 lg:p-20 rounded-sm shadow-2xl prose-content border border-slate-200">
                    <div id="report-content" class="text-sm leading-relaxed space-y-8 text-slate-900"></div>
                </div>
            </div>

            <!-- Certificate View -->
            <div id="certificate-view" class="hidden flex flex-col items-center p-10 pb-24">
                <div id="certificate-paper" class="w-full aspect-[1.414/1] flex flex-col items-center justify-center text-center bg-white border-[20px] border-amber-500/10 text-slate-900 shadow-2xl rounded-sm">
                    <h1 class="text-3xl font-black mb-2 uppercase">AFGE LOCAL 2206</h1>
                    <h2 class="text-5xl font-serif text-amber-600 mb-8">Certificate of Completion</h2>
                    <span id="cert-display-name" class="text-5xl border-b-2 border-slate-300 px-10">Steward Representative</span>
                </div>
            </div>

        </main>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-app.js" type="module"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js" type="module"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js" type="module"></script>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, collection } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

        // --- GLOBAL STATE ---
        const APP_ID = typeof __app_id !== 'undefined' ? __app_id : 'afge-local-2206';
        const MODEL_NAME = 'gemini-1.5-flash'; // Standard model name for public API keys
        let activeCustomKey = localStorage.getItem('afge_gemini_key') || "";
        let activeIndexState = -1;
        let visitedLessons = new Set(JSON.parse(localStorage.getItem('afge_progress') || "[]"));
        let localCaseHistory = [];
        let currentChatMode = "consult";
        let user = null;

        // --- FIREBASE INIT ---
        let appInstance, auth, db;
        const configStr = typeof __firebase_config !== 'undefined' ? __firebase_config : null;
        if (configStr) {
            try {
                const firebaseConfigRaw = JSON.parse(configStr);
                appInstance = initializeApp(firebaseConfigRaw);
                auth = getAuth(appInstance);
                db = getFirestore(appInstance);
            } catch(e) { console.warn("Firebase config parse error. Falling back to local storage."); }
        }

        // --- DATA DEFS ---
        const lessons = [
            { id: 1, title: "Day 1: Roadmap (Union 101)", script: `Welcome, Representative. Today you begin your journey...`, instruction: "The Contract is superior to internal manuals.", activity: "INDEPENDENT TASK: Open the National Contract.", icon: "fa-map-marked-alt" },
            { id: 2, title: "Day 2: Investigation (Detective)", script: `Evidence wins cases, not emotions...`, instruction: "Stress Article 24 timelines.", activity: "INDEPENDENT TASK: Categorize workplace scenarios.", icon: "fa-search" },
            { id: 3, title: "Day 3: Intake (Listening)", script: `Today, you learn to be the Shield...`, instruction: "Recognize Weingarten triggers.", activity: "INDEPENDENT TASK: Write Weingarten invocation script.", icon: "fa-shield-halved" },
            { id: 4, title: "Day 4: Drafting (Secret Wording)", script: `Drafting a grievance is like writing a pleading...`, instruction: "Focus on Remedies.", activity: "INDEPENDENT TASK: Draft a formal grievance.", icon: "fa-feather-pointed" },
            { id: 5, title: "Day 5: Equality Principle", script: `When on approved Union time, you are the Legal Equal...`, instruction: "Equality Principle dissolves hierarchy.", activity: "INDEPENDENT TASK: Write an Equality Declaration.", icon: "fa-balance-scale" },
            { id: 6, title: "Day 6: Info Requests (7114)", script: `Management holds the logs. Use 5 U.S.C. ยง 7114(b)(4)...`, instruction: "Requests must be surgical.", activity: "INDEPENDENT TASK: Draft a 7114 request.", icon: "fa-file-invoice" },
            { id: 7, title: "Day 7: Arbitration Committee", script: `Not every grievance should go to trial...`, instruction: "Assess Litigation Value.", activity: "INDEPENDENT TASK: Write a Merit Summary.", icon: "fa-users" },
            { id: 8, title: "Day 8: Evidence Binder", script: `Organization is advocacy...`, instruction: "Organize the Silent Witness.", activity: "INDEPENDENT TASK: Create Table of Contents.", icon: "fa-folder-open" },
            { id: 9, title: "Day 9: Trial Script (IRAC)", script: `Arbitration is a trial. Use IRAC logic...`, instruction: "Framing the hook.", activity: "INDEPENDENT TASK: Write Opening Statement.", icon: "fa-gavel" },
            { id: 10, title: "Day 10: Mock Trial & Graduation", script: `Final hurdle: The art of cross-examination...`, instruction: "Ask only leading questions.", activity: "GRADUATION TASK: Conduct Mock Trial.", icon: "fa-award" }
        ];

        // --- CORE FUNCTIONS ---

        window.formatGeneratedText = function(text) {
            if (!text) return "";
            let formatted = text.trim().replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            formatted = formatted.replace(/^\s*[-*]\s+(.*)$/gm, '<li>$1</li>').replace(/(<li>.*<\/li>(?:\s*<li>.*<\/li>)*)/gms, '<ul>$1</ul>');
            return formatted.split(/\n\s*\n/).map(p => (p.startsWith('<ul') || p.startsWith('<h')) ? p : `<p>${p.replace(/\n/g, '<br>')}</p>`).join('');
        };

        window.switchMode = function(m) {
            const ids = ['academy-view', 'field-kit-view', 'ai-guide-view', 'resources-view', 'setup-view', 'certificate-view', 'report-display-view'];
            ids.forEach(id => { const el = document.getElementById(id); if(el) el.classList.add('hidden'); });
            const target = document.getElementById(m + '-view');
            if(target) target.classList.remove('hidden');
        };

        window.toggleMobileSidebar = function(show) {
            const sb = document.getElementById('mobile-sidebar');
            const ov = document.getElementById('mobile-sidebar-overlay');
            if (show) { sb.classList.remove('-translate-x-full'); ov.classList.remove('pointer-events-none', 'opacity-0'); ov.classList.add('opacity-100'); }
            else { sb.classList.add('-translate-x-full'); ov.classList.add('pointer-events-none', 'opacity-0'); }
        };

        window.showWelcomeScreen = function() {
            const c = document.getElementById('image-container');
            if (!c) return;
            c.innerHTML = `<div class="text-center max-w-lg px-8 animate-slide-up flex flex-col items-center"><div class="w-32 h-32 bg-amber-500/10 rounded-full flex items-center justify-center mb-6 border-4 border-amber-500/20 text-6xl text-amber-500"><i class="fa-solid fa-graduation-cap"></i></div><h2 class="text-2xl font-black mb-2 uppercase">Academy Online</h2><p class="text-slate-300 italic">"Select a syllabus day to begin."</p></div>`;
        };

        window.selectLesson = function(index) {
            activeIndexState = index;
            const l = lessons[index];
            visitedLessons.add(l.id);
            localStorage.setItem('afge_progress', JSON.stringify(Array.from(visitedLessons)));
            saveProgressToFirestore();
            updateSidebarStyles();
            window.switchMode('academy');
            document.getElementById('master-play-btn').style.display = 'flex';
            document.getElementById('steward-instruction').innerHTML = `<p>${l.instruction}</p>`;
            document.getElementById('hands-on-activity').innerHTML = `<p>${l.activity}</p>`;
            document.getElementById('live-transcript').innerHTML = window.formatGeneratedText(l.script);
            document.getElementById('scenario-btn').classList.remove('hidden');
            document.getElementById('summary-btn').classList.remove('hidden');
            document.getElementById('peer-review-section').classList.remove('hidden');
            updateProgress();
            window.toggleMobileSidebar(false);
        };

        window.playCurrentLesson = function() {
            if (activeIndexState === -1) return;
            document.getElementById('live-transcript-container').scrollIntoView({ behavior: 'smooth' });
        };

        // --- AI API ---
        async function fetchGemini(prompt, retries = 5) {
            if (!activeCustomKey) throw new Error("API Key not set.");
            const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${activeCustomKey}`;
            const payload = { contents: [{ parts: [{ text: prompt }] }] };

            for (let i = 0; i < retries; i++) {
                try {
                    const res = await fetch(endpoint, { method: 'POST', body: JSON.stringify(payload) });
                    if (!res.ok) throw new Error(`HTTP ${res.status}`);
                    const data = await res.json();
                    return data.candidates?.[0]?.content?.parts?.[0]?.text;
                } catch (err) {
                    if (i === retries - 1) throw err;
                    await new Promise(r => setTimeout(r, Math.pow(2, i) * 1000));
                }
            }
        }

        window.generateSummary = async function() {
            if (activeIndexState === -1) return;
            const lt = document.getElementById('live-transcript');
            lt.innerHTML = "Summarizing...";
            try {
                const res = await fetchGemini(`Summarize for a union steward: "${lessons[activeIndexState].script}"`);
                lt.innerHTML = window.formatGeneratedText(res);
            } catch(e) { alert("Error: " + e.message); }
        };

        window.generatePracticeScenario = async function() {
            const box = document.getElementById('ai-challenge-box');
            if (activeIndexState === -1) return;
            document.getElementById('ai-challenge-container').classList.remove('hidden');
            document.getElementById('activity-content-container').classList.add('hidden');
            box.innerHTML = "Generating case...";
            try {
                const res = await fetchGemini(`Create a union grievance case for Day ${activeIndexState + 1}`);
                box.innerHTML = window.formatGeneratedText(res);
            } catch(e) { box.innerHTML = "Error: " + e.message; }
        };

        window.saveUserKeyUI = async function() {
            const val = document.getElementById('user-api-key').value.trim();
            if (!val) return;
            activeCustomKey = val;
            localStorage.setItem('afge_gemini_key', val);
            if (db && user) {
                try { await setDoc(doc(db, 'artifacts', APP_ID, 'users', user.uid, 'settings', 'profile'), { apiKey: val }, { merge: true }); } catch(e) {}
            }
            alert("API Key saved successfully!");
            window.switchMode('academy');
        };

        // --- HELPERS ---
        async function saveProgressToFirestore() {
            if (db && user) {
                try { await setDoc(doc(db, 'artifacts', APP_ID, 'users', user.uid, 'settings', 'progress'), { visited: Array.from(visitedLessons) }); } catch (e) {}
            }
        }

        function updateSidebarStyles() {
            const buttons = document.querySelectorAll('#nav-week-1 button, #nav-week-2 button');
            buttons.forEach((b, i) => {
                const id = i + 1;
                if (activeIndexState === i) b.classList.add('active-nav-item');
                else if (visitedLessons.has(id)) b.classList.add('visited-nav-item');
            });
        }

        function updateProgress() {
            const bar = document.getElementById('progress-bar');
            const perc = activeIndexState === -1 ? 0 : ((activeIndexState + 1) / lessons.length) * 100;
            if(bar) bar.style.width = perc + '%';
        }

        async function init() {
            if (auth) {
                try {
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) { await signInWithCustomToken(auth, __initial_auth_token); }
                    else { await signInAnonymously(auth); }
                } catch(e) {}
                onAuthStateChanged(auth, async (u) => {
                    if (u) {
                        user = u;
                        const snap = await getDoc(doc(db, 'artifacts', APP_ID, 'users', user.uid, 'settings', 'profile'));
                        if (snap.exists() && !activeCustomKey) {
                            activeCustomKey = snap.data().apiKey;
                            localStorage.setItem('afge_gemini_key', activeCustomKey);
                        }
                    }
                });
            }
            renderUI();
        }

        function renderUI() {
            const w1 = document.getElementById('nav-week-1');
            const w2 = document.getElementById('nav-week-2');
            lessons.forEach((l, i) => {
                const btn = document.createElement('button');
                btn.onclick = () => window.selectLesson(i);
                btn.className = "w-full text-left p-3 rounded-xl text-xs font-semibold border border-transparent text-slate-400";
                btn.innerHTML = `<i class="fa-solid ${l.icon} mr-3"></i> Day ${l.id}`;
                if (l.id <= 5) w1.appendChild(btn); else w2.appendChild(btn);
            });
            window.showWelcomeScreen();
        }

        init();
    </script>
</body>
</html>
